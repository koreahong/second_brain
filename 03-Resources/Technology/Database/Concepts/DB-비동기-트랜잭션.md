---
title: DB 비동기 트랜잭션
type: resource
tags:
- db
- transaction
created: '2025-11-30'
updated: '2025-11-30'
aliases: []
---

## 개념

- 트랜잭션은 db 커넥션에서 교통정리하는 단위이다.
- 트랜잭션은 데이터베이스에서 여러 작업을 한 번에 처리해서 모두 성공하거나 모두 실패하게 만드는 것입니다.
- 트랜잭션은 데이터베이스에서 일련의 작업을 하나의 원자적 단위로 처리하여 모든 작업이 성공하거나 모두 취소되도록 보장하는 과정입니다.
- 일련의 작업을 묶어서 관리하여, 모두 실패하거나 성공하도록 보장하는 단위
## 목적

- 비동기처리를 하는데 동시성을 제어하기 위해서 서칭하게 됨
## 서칭내용

- 한 커넥션안에서 여러 트랜잭션을 동시에 생성할 수 없다.
- 트랜잭션으로 관리하는 것이 커넥션 단위로 관리하는 것보다 더 효율적이다.
## 1. 기본 개념 이해하기

### 커넥션(Connection)

- 정의: 애플리케이션과 데이터베이스 간의 연결 고리입니다.
- 역할: 데이터를 주고받고, 명령을 실행할 수 있게 해줍니다.
### 트랜잭션(Transaction)

- 정의: 데이터베이스에서 하나 이상의 작업을 하나의 단위로 묶어 처리하는 과정입니다.
- 목적: 모든 작업이 성공적으로 완료되거나, 하나라도 실패하면 모두 취소되어 데이터의 일관성과 무결성을 유지합니다.
## 2. 커넥션과 트랜잭션의 관계

### 한 커넥션에 하나의 트랜잭션

- 일반적 사용: 대부분의 경우, 하나의 커넥션은 동시에 하나의 트랜잭션만을 처리합니다.
- 이유: 트랜잭션은 일련의 작업을 원자적으로 처리하기 위해 설계되었기 때문에, 하나의 트랜잭션이 완료되기 전까지는 다른 트랜잭션을 시작하지 않습니다.
### 여러 커넥션에서 각각 트랜잭션 처리

- 멀티 커넥션 사용: 여러 개의 커넥션을 열고, 각 커넥션에서 독립적으로 트랜잭션을 처리할 수 있습니다.
- 장점: 동시에 여러 작업을 병렬로 처리할 수 있어 성능을 향상시킬 수 있습니다.
- 주의점: 데이터 일관성을 유지하기 위해 트랜잭션의 격리 수준을 적절히 설정해야 합니다.
### 한 커넥션에서 여러 트랜잭션 처리

- 직접적인 여러 트랜잭션: 일반적으로 하나의 커넥션에서 동시에 여러 트랜잭션을 처리할 수 없습니다.
- 대안 - 중첩 트랜잭션(Nested Transactions):
  - 일부 데이터베이스는 중첩 트랜잭션을 지원하거나, **저장점(Savepoints)**을 통해 비슷한 기능을 제공합니다.
  - 저장점: 트랜잭션 내에서 특정 시점까지의 작업을 저장해두고, 필요 시 그 시점으로 롤백할 수 있습니다.
## 3. 트랜잭션 처리 시나리오

### 시나리오 1: 여러 커넥션에서 독립적인 트랜잭션 처리

예시:

- 커넥션 A:
  1. 트랜잭션 b 시작
  1. 테이블 X 수정
  1. 트랜잭션 b 커밋
- 커넥션 B:
  1. 트랜잭션 c 시작
  1. 테이블 Y 수정
  1. 트랜잭션 c 커밋
특징:

- 커넥션 A와 B는 독립적으로 트랜잭션을 처리합니다.
- 서로의 작업에 영향을 주지 않습니다.
- 병렬 처리로 인해 성능 향상 가능.
### 시나리오 2: 한 커넥션에서 트랜잭션의 단계별 처리

예시:

- 커넥션 A:
  1. 트랜잭션 b 시작
  1. 테이블 X 수정
  1. 트랜잭션 b 커밋
  1. 트랜잭션 c 시작
  1. 테이블 Y 수정
  1. 트랜잭션 c 커밋
특징:

- 한 커넥션에서 순차적으로 두 개의 트랜잭션(b와 c)을 처리합니다.
- 각 트랜잭션은 독립적으로 커밋됩니다.
- 각 트랜잭션이 완료된 후에 다음 트랜잭션을 시작.
### 시나리오 3: 한 커넥션에서 중첩 트랜잭션 또는 저장점 사용

예시:

- 커넥션 A:
  1. 트랜잭션 b 시작
  1. 테이블 X 수정
  1. 저장점 S1 설정
  1. 테이블 Y 수정
  1. 에러 발생
  1. 저장점 S1으로 롤백
  1. 트랜잭션 b 커밋
특징:

- 트랜잭션 b 내에서 저장점 S1을 설정하여, 특정 시점까지의 작업을 저장.
- 이후 작업에서 오류가 발생하면 저장점 S1으로 롤백하여, 트랜잭션 b 전체를 취소하지 않고 일부만 되돌림.
- 이를 통해 보다 세밀한 트랜잭션 관리 가능.
## 4. 트랜잭션 사용 시 고려사항

### 1. 원자성 보장

- 트랜잭션 내 모든 작업이 성공하거나, 하나라도 실패하면 전체를 취소해야 합니다.
- 이를 통해 데이터의 일관성을 유지합니다.
### 2. 격리 수준 설정

- 여러 트랜잭션이 동시에 실행될 때 데이터의 일관성을 유지하기 위해 격리 수준을 적절히 설정해야 합니다.
- 격리 수준이 높을수록 동시성은 낮아지고, 데이터 일관성은 높아집니다.
### 3. 트랜잭션 범위 최소화

- 트랜잭션이 길어지면 잠금이 오래 유지되어 다른 트랜잭션의 성능을 저하시킬 수 있습니다.
- 가능한 한 트랜잭션 범위를 작게 유지하여 성능을 최적화합니다.
### 4. 에러 핸들링

- 트랜잭션 내에서 오류가 발생했을 때 적절히 롤백하여 데이터의 무결성을 유지해야 합니다.
- 프로그래밍 언어와 데이터베이스 드라이버에서 제공하는 트랜잭션 관리 기능을 활용합니다.
## 5. 다양한 트랜잭션 사용 사례

### 1. 은행 계좌 이체

개념:

- 계좌 A에서 계좌 B로 돈을 이체할 때, 출금과 입금을 하나의 트랜잭션으로 처리합니다.
- 출금이 성공하고 입금이 성공하면 트랜잭션을 커밋.
- 출금은 되었지만 입금에서 오류가 발생하면 트랜잭션을 롤백하여 출금도 취소.
장점:

- 데이터 일관성 보장.
- 부분적인 업데이트로 인한 오류 방지.
### 2. 주문 처리 시스템

개념:

- 사용자가 상품을 주문할 때, 재고 감소, 주문 기록 저장, 결제 처리 등을 하나의 트랜잭션으로 처리.
- 모든 작업이 성공하면 트랜잭션을 커밋.
- 하나라도 실패하면 모든 작업을 취소하여 데이터의 일관성을 유지.
장점:

- 재고와 주문 데이터의 일관성 유지.
- 결제와 주문이 동시에 처리되어 오류 발생 시 데이터 불일치 방지.
### 3. 사용자 등록 및 프로파일 설정

개념:

- 새로운 사용자를 등록할 때, 사용자 정보 저장, 프로파일 초기화, 환영 이메일 발송 등을 하나의 트랜잭션으로 처리.
- 모든 작업이 성공하면 트랜잭션을 커밋.
- 하나라도 실패하면 트랜잭션을 롤백하여 사용자 등록을 취소.
장점:

- 사용자 데이터의 완전성 보장.
- 부분적인 데이터 저장으로 인한 문제 방지.
### 4. 데이터 마이그레이션

개념:

- 데이터를 한 테이블에서 다른 테이블로 이동할 때, 데이터 복사, 원본 삭제 등을 하나의 트랜잭션으로 처리.
- 모든 작업이 성공하면 트랜잭션을 커밋.
- 하나라도 실패하면 트랜잭션을 롤백하여 데이터 손실 방지.
장점:

- 데이터 이동의 안전성 보장.
- 데이터 일관성 유지.
## 6. 트랜잭션의 장점과 단점

### 장점

- 데이터 일관성 유지: 모든 작업이 성공적으로 완료되거나 모두 취소되어 데이터의 무결성을 유지합니다.
- 오류 복구 용이: 오류 발생 시 트랜잭션을 롤백하여 이전 상태로 복구할 수 있습니다.
- 동시성 제어: 여러 트랜잭션이 동시에 실행될 때 데이터의 일관성을 유지할 수 있습니다.
### 단점

- 성능 저하: 트랜잭션을 사용하면 잠금이 발생하여 동시성 작업의 성능이 저하될 수 있습니다.
- 복잡성 증가: 트랜잭션 관리가 복잡해질 수 있으며, 특히 중첩 트랜잭션이나 저장점을 사용할 때 관리가 어려워질 수 있습니다.
- 데드락 발생 가능성: 여러 트랜잭션이 서로 자원을 기다리며 무한 대기 상태에 빠지는 데드락(Deadlock)이 발생할 수 있습니다.
## 7. 요약

- 커넥션과 트랜잭션: 하나의 커넥션은 일반적으로 하나의 트랜잭션을 동시에 처리하며, 여러 커넥션을 사용하면 여러 트랜잭션을 병렬로 처리할 수 있습니다.
- 트랜잭션의 원자성: 모든 작업이 성공하거나 실패함으로써 데이터의 일관성을 보장합니다.
- 격리 수준: 데이터 동시성 작업 시 일관성을 유지하기 위해 격리 수준을 적절히 설정해야 합니다.
- 트랜잭션 사용 사례: 은행 계좌 이체, 주문 처리, 사용자 등록 등 다양한 상황에서 데이터의 무결성과 일관성을 유지하기 위해 사용됩니다.
- 장단점: 데이터 일관성을 유지할 수 있지만, 성능 저하나 복잡성 증가 등의 단점도 존재합니다.
트랜잭션의 개념을 이해하고, 상황에 맞게 적절히 활용하면 데이터베이스 애플리케이션의 안정성과 신뢰성을 크게 향상시킬 수 있습니다.

---

## 📎 Related

<!-- 자동 생성된 섹션 - 수동으로 링크를 추가하세요 -->

### Projects

### Knowledge

### Insights

