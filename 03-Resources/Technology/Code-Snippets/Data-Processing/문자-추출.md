---
title: 문자 추출
type: resource
tags:
- Query
---

## 🧾 정리표

---

## ✅ 1. string_to_array(text, delimiter)

### 📌 용도

- 문자열을 특정 구분자로 나누어 배열로 만듭니다.
### 📌 예시

```sql
sql
복사편집
SELECT string_to_array('hello world test', ' ');
-- 결과: {hello,world,test}

```

### ✅ 사용된 이유

- content_text를 공백 기준으로 나누어 배열로 만들기 위해 사용.
---

## ✅ 2. unnest(array)

### 📌 용도

- 배열을 row 단위로 펼칩니다 (flatten).
### 📌 예시

```sql
sql
복사편집
SELECT unnest(ARRAY['a','b','c']);
-- 결과:
-- a
-- b
-- c

```

### ✅ 사용된 이유

- string_to_array()로 만든 배열을 단어별로 펼쳐서 각각 가공할 수 있도록 함.
---

## ✅ 3. left(text, n)

### 📌 용도

- 문자열의 왼쪽에서 n글자를 추출합니다.
### 📌 예시

```sql
sql
복사편집
SELECT left('hello', 1);  -- 결과: 'h'

```

### ✅ 사용된 이유

- 단어의 첫 글자를 대문자로 만들기 위해 upper(left(..., 1))에서 사용.
---

## ✅ 4. substring(text FROM start)

### 📌 용도

- 문자열의 지정된 위치부터 끝까지를 추출합니다.
### 📌 예시

```sql
sql
복사편집
SELECT substring('hello' FROM 2);  -- 결과: 'ello'

```

### ✅ 사용된 이유

- 단어에서 첫 글자 제외 나머지를 가져오기 위해 사용 → 소문자로 변환.
---

## ✅ 5. upper(text)

### 📌 용도

- 문자열 전체를 대문자로 변환합니다.
### 📌 예시

```sql
sql
복사편집
SELECT upper('abc');  -- 결과: 'ABC'

```

### ✅ 사용된 이유

- 단어의 첫 글자를 대문자로 만들기 위해 사용.
---

## ✅ 6. lower(text)

### 📌 용도

- 문자열 전체를 소문자로 변환합니다.
### 📌 예시

```sql
sql
복사편집
SELECT lower('ABC');  -- 결과: 'abc'

```

### ✅ 사용된 이유

- 단어의 첫 글자를 제외한 부분을 소문자로 바꾸기 위해 사용.
---

## ✅ 7. STRING_AGG(expression, delimiter [ORDER BY ...])

### 📌 용도

- 여러 row의 문자열을 하나로 합칩니다 (지정한 구분자로 연결).
### 📌 예시

```sql
sql
복사편집
SELECT STRING_AGG(word, ' ') FROM (VALUES ('Hello'), ('World')) AS t(word);
-- 결과: 'Hello World'

```

### ✅ 사용된 이유

- 가공된 단어들을 다시 문장처럼 연결하기 위해 사용.
---

## ✅ (보조적으로 주석된) ROW_NUMBER() OVER (PARTITION BY ...)

### 📌 용도

- 각 그룹 내에서 순서를 매깁니다.
### 📌 예시

```sql
sql
복사편집
SELECT
  word,
  ROW_NUMBER() OVER () AS rk
FROM (VALUES ('a'), ('b'), ('c')) AS t(word);
-- 결과:
-- a | 1
-- b | 2
-- c | 3

```

### ✅ 쿼리에서는

- 정렬 순서를 보장하고자 했으나 실제 쿼리에서는 사용되지 않음 (주석 처리됨).
---

## ✅ 함수 개요

```sql
sql
복사편집
regexp_replace(source_string, pattern, replacement, flags)

```

---

## 🔍 하나씩 설명

### 1️⃣ 'a1b2c3': 원본 문자열

- 우리가 처리하고 싶은 문자열입니다.
- 여기선 문자+숫자 혼합 문자열
---

### 2️⃣ '\D': 정규식 패턴

- \D는 숫자가 아닌 문자(Non-digit) 를 의미합니다.
- 즉, 'a', 'b', 'c' → 이들이 매칭됨
---

### 3️⃣ '': 치환 문자열 (replacement)

- 매칭된 값을 이걸로 바꾸겠다는 의미
- 여기서는 ''이므로, 매칭된 문자 제거
---

### 4️⃣ 'g': 플래그 (flags)

- 'g' = global, 전체 매치
- 첫 번째 매칭 하나만 바꾸지 않고, 문자열 전체에서 반복 적용
---

## 🎯 최종 동작 정리

```sql
sql
복사편집
regexp_replace('a1b2c3', '\D', '', 'g')

```

- 숫자가 아닌 문자(a, b, c)를 전부 제거
- 남는 건: '123'
---

## 🔁 확장 예시