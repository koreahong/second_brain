---
type: weekly-reflection
title: 2025년 10월 13일
imported: 2025-11-30
notion_id: 28bc6d43-3b4d-80e2-8dec-ea9e7f83b7da
mig_status: synced
tags: ["\ube44\uc6a9 \ucd5c\uc801\ud654", "\ubb38\uc81c\ud574\uacb0", "\uc131\ub2a5\uac1c\uc120", "\uc790\ub3d9\ud654"]
---

# 2025년 10월 13일

## 🚩 문제 상황

• Snowflake 저장소에 오래된 테이블, 중복된 마트, 사용되지 않는 스테이징 데이터가 누적되어 저장 비용이 증가하고 관리 효율이 저하됨
• MFT 파이프라인에서 대용량 parquet 파일 로드 및 Postgres 쿼리 성능 저하 발생
    ◦ WHERE 조건 누락으로 풀스캔 빈번
    ◦ 불필요한 컬럼 SELECT로 Snowflake 비용 급증

## 🔧 대처 방법

1. Snowflake 저장소 정리
    ◦ Raw, Stage, Mart 계층별 테이블 스캔 후 최근 90일 미사용 테이블 식별
    ◦ 미사용 테이블을 별도 아카이브 DB로 이관 후 삭제
    ◦ 테이블별 last_accessed, row_count, storage_bytes 메타데이터를 DataHub Tag로 반영
2. MFT 성능 최적화
    ◦ Parquet 파일 read 시 pyarrow.dataset 기반으로 selective column load 적용
    ◦ Postgres 쿼리 내 WHERE 조건 필수 검증 로직 추가 (sqlparse 기반)
    ◦ Airflow DAG 레벨에서 쿼리 실행 전 자동 검증 Hook 구현

## ✨ 성과 / 개선점

성과:
• Snowflake 저장소 용량 약 35% 절감
• Airflow DAG 평균 실행 시간 40% 단축
• 비용 예측 가능성 향상 및 쿼리 표준화 기반 마련
개선:
• 자동화 스크립트 실행 시 테이블 삭제 승인 절차가 번거로움
• MFT 쿼리 검증 로직이 일부 복잡한 쿼리(CTE, JOIN)에서는 완벽하지 않음

## 🤝 배운 점

단순 비용 절감이 아니라 **데이터 생명주기 관리(Lifecycle Management)**의 중요성 인식성능 최적화는 코드 수준이 아니라 데이터 사용 패턴을 기준으로 접근해야 효과적임을 체감

## 역량

#비용 최적화 #문제해결 #성능개선 #자동화


## 추가 내용

스노우플레이크 저장소 정리 및 관리 최적화

- 테이블 정리 / 불필요 테이블 마이그레이션
---

mft 성능 최적화

1. pqrquet파일 읽기
1. postgres 사용 where 조건 필수

---

## 📎 Related

### 관련 프로젝트

**1. [[MFT팀-배치-작업|MFT 배치 성능 최적화]]** (9/22 시작 → 10/13 최적화)
   - 9월 22일: MFT 배치 개발 시작 (airflow, alembic 구성)
   - **10월 13일: 성능 최적화 작업** ← 현재
   - 문제:
     - 대용량 parquet 파일 로드 성능 저하
     - Postgres WHERE 조건 누락으로 풀스캔
     - 불필요한 컬럼 SELECT로 Snowflake 비용 증가
   - 해결:
     - pyarrow.dataset 기반 selective column load
     - sqlparse 기반 WHERE 조건 필수 검증 로직
     - Airflow DAG 레벨 자동 검증 Hook 구현
   - 성과: **DAG 평균 실행 시간 40% 단축**

**2. Snowflake 저장소 정리 및 비용 최적화** (10/13 완료)
   - 테이블 계층별 스캔 (Raw/Stage/Mart)
   - 90일 미사용 테이블 식별 및 아카이브
   - DataHub Tag로 메타데이터 반영 (last_accessed, row_count, storage_bytes)
   - 성과: **저장소 용량 약 35% 절감**
