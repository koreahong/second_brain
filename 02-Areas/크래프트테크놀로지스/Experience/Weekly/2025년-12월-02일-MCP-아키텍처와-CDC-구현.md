---
tags:
  - insight
  - automation
  - data-engineering
  - claude-code
  - orchestration
  - mcp
  - data-governance
  - cdc
  - qraft
created: '2025-12-02T02:52:00.000Z'
updated: '2025-12-07T00:00:00.000Z'
title: Claude Code MCP 아키텍처와 데이터 거버넌스 최적화
type: insight
notion_id: 2bdc6d43-3b4d-80f9-9a8e-c417026a4623
company: 크래프트테크놀로지스
related_articles:
  - Claude-Code-Context-관리-97퍼센트-실패하는-이유
  - Claude-Code-전문-Agent-30개-Part1
  - Claude-심리-프롬프팅으로-45퍼센트-성능-향상
connection_quality: high
has_temporal_context: true
has_thematic_context: true
---

<!--
Notion 원본: https://www.notion.so/2bdc6d433b4d80f99a8ec417026a4623
마이그레이션 날짜: 2025-12-07
-->

# Claude Code MCP 아키텍처와 데이터 거버넌스 최적화

## 💡 핵심 인사이트

**개발 환경 자동화와 데이터 거버넌스는 모두 '제약 조건 내에서의 최적화' 문제다.**
토큰 사용량을 줄이기 위한 MCP 아키텍처나, 라이선스 비용을 줄이기 위한 CDC 전략이나 본질은 같다 - 제약을 파악하고, 구조적 해결책을 설계하는 것.

## 📖 경험 (Context)

**언제:** 2025년 12월 (크래프트테크놀로지스 근무 중)

**무슨 일:**
1. **Claude Code MCP 환경 구축**
   - dbt, Airflow, Snowflake, Context7 등 MCP 서버 통합
   - Agent/Hook 아키텍처 설계 및 구현
   - Jira/Confluence 문서 자동화

2. **LSEG Snowflake 데이터 거버넌스**
   - 1,000개 테이블 CDC (Change Data Capture) 구현
   - 라이선스 비용 최적화 (20명분 → 1명분)
   - 컴플라이언스 준수하면서 데이터 접근성 확보

## 🤔 생각의 흐름

### 처음 생각

**MCP 환경:**
- Claude Code에 필요한 MCP 서버들을 그냥 연결하면 되겠지?
- Agent들을 각각 만들어서 사용하면 편하겠네

**데이터 거버넌스:**
- CDC가 필요하다고? 그냥 복제하면 되는 거 아닌가?

### 전환점

**MCP 아키텍처:**
토큰 사용량이 폭발적으로 증가하는 걸 보고 깨달음 → "전문 Agent들을 **관리하는 중앙 Agent**가 필요하다"
- 각 Agent가 독립적으로 동작하면 중복 작업 발생
- 중앙에서 orchestration하면 효율 극대화

**데이터 비용:**
작년에 20명분 라이선스 비용 낭비 사례를 보고 → "구조적 문제는 구조적으로 해결해야 한다"
- 사용자마다 원천 접근 권한 주는 건 돈 낭비
- CDC로 자체 테이블 만들어서 1명 라이선스로 해결

### 깨달음

**자동화의 핵심은 계층 구조다**
- 단순히 도구를 많이 연결하는 게 아니라
- 도구들을 **어떻게 orchestrate하느냐**가 중요

**비용 최적화는 제약을 받아들이는 것에서 시작한다**
- "모두에게 원천 접근 권한을" (X)
- "필요한 데이터만, 제어된 방식으로" (O)

## 🎯 First Principles 분석

🔍 근본적인 진실은 무엇인가? 가정을 벗겨내면 남는 것은?

**가정:**
- 더 많은 도구 = 더 나은 환경
- 더 많은 접근 권한 = 더 나은 데이터 활용

**근본 원리:**
- 효율성 = (가치 / 비용)
- 좋은 아키텍처 = 명확한 책임 분리 + 효과적인 조율
- 거버넌스 = 제약 조건 하에서의 최대 가치 창출

**새로운 접근:**
- **MCP:** 중앙 Agent가 전문 Agent들을 orchestrate
- **데이터:** CDC로 "읽기 전용, 최신 상태 유지" 레이어 생성

## 🧠 Mental Model

### 아키텍처 설계 = 계층적 위임

```
중앙 조율자 (Central Orchestrator)
    ↓
전문가 Agent들 (Expert Agents)
    ↓
실제 도구들 (Tools/MCP Servers)
```

**적용 가능한 다른 상황들:**

**업무:**
- 팀 구조: 모든 결정을 리더가 하는 게 아니라, 각 전문가에게 위임하되 조율은 중앙에서
- 시스템 설계: Microservices 구조와 동일 - 각 서비스는 독립적이되 API Gateway가 orchestrate

**개인생활:**
- 루틴 관리: 각 활동(운동, 독서, 코딩)을 독립적으로 관리하되, 주간 리뷰에서 조율

**관계:**
- 업무 협업: 각자 전문 영역에서 자율성 + 정기 싱크로 방향 조정

## ✅ 실천 계획

이 깨달음을 어떻게 실천할 것인가?

### 1. 즉시 실천:
- **MCP 중앙 Agent 구현 완료**
  - dbt, Airflow, DataHub 전문 Agent 생성
  - 중앙 Agent가 작업 흐름 관리
  - 토큰 사용량 모니터링 설정

- **CDC 프로세스 문서화**
  - 1,000개 테이블 마이그레이션 프로세스
  - dbt delete+insert 증분 로직
  - 컴플라이언스 체크리스트

### 2. 습관화:
- 새로운 도구/Agent 추가 시 → "이게 중앙에서 관리될 수 있나?" 먼저 질문
- 데이터 접근 요청 받으면 → "CDC로 제공 가능한가?" 먼저 검토
- 매주 금요일: MCP 토큰 사용량 리뷰

### 3. 장기 목표:
- **Q1 2025:** MCP 아키텍처 전사 확대
  - 다른 팀원들도 동일한 환경 구축
  - Best practices 문서화

- **Q2 2025:** 데이터 거버넌스 플랫폼화
  - CDC를 셀프서비스로 전환
  - 자동 컴플라이언스 체크

## 📎 Related

### 관련 아티클 (같은 시기, 같은 주제)
**2025년 12월 초 - Claude Code 아키텍처 학습**
- [[03-Resources/Articles/Claude-Code-Context-관리-97퍼센트-실패하는-이유|Context 관리 - 97%가 실패하는 이유]] (2025-12-04)
  - 4-Layer Orchestra Architecture 개념 → 이 인사이트의 중앙 Agent 패턴과 동일
  - Context Window Death Spiral 문제 → 토큰 최적화 필요성 공감
  - WebSocket 시스템 3일 완성 사례 → 실제 orchestration 효과 증명

- [[03-Resources/Articles/Claude-Code-전문-Agent-30개-Part1-핵심-개발자|전문 Agent 30개 Part1]] 
  - Specialist Agent 패턴 → dbt/Airflow/DataHub 전문 Agent 설계에 영향
  
- [[03-Resources/Articles/Claude-심리-프롬프팅으로-45퍼센트-성능-향상|심리 프롬프팅 45% 성능 향상]]
  - Agent 프롬프트 최적화 → 토큰 효율 개선 적용

### 관련 프로젝트 (같은 회사, 같은 시기)
**크래프트테크놀로지스 2025년 12월**
- 프로젝트 링크 예정 (LSEG CDC 프로젝트)
- 프로젝트 링크 예정 (MCP 환경 구축)

### 관련 기술 지식
- DataHub - 데이터 거버넌스
- DBT - 데이터 변환 (delete+insert 증분)
- Airflow - 워크플로우 오케스트레이션
- Claude Code - MCP 아키텍처

### 다음 단계
- Jira/Confluence 자동화 고도화
- 데이터 계약(Data Contract) 자동 검증 시스템

---

## 📄 원본 콘텐츠 (Notion에서 마이그레이션)

MCP - dbt, airflow, context7, snowflake등 활용

MCP 세팅하여, claude code를 통한 개발 및 유지보수 환경을 최적화

agent, hook 등에 대한 아키텍쳐 구현

각 agent를 관리하는 중앙 agent를 만들고, 각 분야의 expert agent 생성 → 토큰 사용량 줄이고, 효율 Up

jira, confluence 문서 자동화 구축

---

LSEG snowflake 데이터 CDC
사용자 1명으로 계약해서 사원들이 원천을 보면 안되고 CDC한 자체 테이블을 바라보게 해야함. 매일 1000개 테이블 마이그레이션 프로세스 추가.

작년에는 해당 문제로 인해서 20명분 이상의 비용지출을 추가로 해서 손실이 많이 발생함.

원본에 대한 key column 중심으로 dbt delete+insert 증분형태로 작성.

데이터계약 제약조건 컴플라이언스를 지켜야 하는 상황임
