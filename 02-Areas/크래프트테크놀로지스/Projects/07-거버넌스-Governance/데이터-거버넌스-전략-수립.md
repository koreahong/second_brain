---
tags:
  - projects
  - governance
  - qraft
  - datahub
  - keycloak
  - strategy
created: '2025-11-30'
updated: '2025-11-30'
status: 완료
team: ML Platform (T)
period: 2025-08 ~ 2025-11
company: 크래프트테크놀로지스
---
# 데이터 거버넌스 전략 수립

## 📋 Overview

**기간**: 2025년 8월 ~ 11월  
**주도**: ML Platform (T)  
**배경**: CFO 비용 의구심 + 팀별 데이터 무단 접근 사고  
**목표**: 팀별 데이터 격리, 오너십 명확화, 메타데이터 자동 관리

---

## 🔥 문제 인식

### 초기 문제 발견 (2025년 8월 11일)

[[2025년-8월-11일|주간 회고]]에서 드러난 심각한 현황:

> **"데이터 관리가 개판임"**
> - 팀별로 어떤 데이터를 쓰는지 파악조차 안됨
> - Vendor 과금 오류 발견 → 누가 쓰는 데이터인지 모름
> - CFO: "우리가 이 비용을 왜 내고 있는지 모르겠다"

**구체적 문제점**:
1. **Data Ownership 부재**: 각 테이블/DAG 책임자 불명확
2. **접근 제어 없음**: 모든 팀이 모든 데이터 접근 가능
3. **메타데이터 부족**: 데이터 출처, 용도, 의존성 추적 불가
4. **비용 불투명**: 벤더별 데이터 사용량 파악 어려움

**당시 상황**:
- 벤더 수: 5개 → 12개로 급증 (8월 기준)
- DAG 수: 30개 이상
- 팀 수: Strategy (T), HFT (T), MFT (T), ML Platform (T), AI Product (T) 등 5개 팀
- **문제**: 누가 어떤 데이터를 소유하고 사용하는지 1시간 이상 추적 필요

### 트리거 이벤트 (2025년 9월)

**사고 발생**: Strategy 팀이 HFT 팀 DAG 수정 → **1시간 다운타임**

**CFO의 핵심 질문**:
> "팀별로 데이터를 완전히 격리할 수 없나?"

**배경**:
- Airflow에 권한 관리 없음 → 모든 팀이 모든 DAG 수정 가능
- HFT 팀은 실시간 트레이딩 의존 → 1시간 다운타임 = 막대한 손실
- Strategy 팀은 자신들 DAG 수정한 줄 알았으나 실수로 HFT DAG 건드림

**이 사고로 인한 요구사항**:
1. **팀별 DAG 격리**: 각 팀은 자기 팀 DAG만 수정 가능
2. **데이터 오너십**: 각 테이블/뷰의 책임 팀 명확화
3. **접근 제어**: 오너가 아닌 팀은 읽기만 가능

### 지속적인 우려 (2025년 10월 27일)

[[2025년-10월-27일|주간 회고]]에서 거버넌스 중요성 재확인:

> **"거버넌스에 대한 중요성을 느낌"**
> - 팀 간 데이터 공유 시 저항: "왜 잘하고 있는 우리 팀이 못하는 팀에게 공유해야 하나?"
> - IP 노출 우려: 핵심 알고리즘 포함된 데이터 공유 거부
> - 데이터 품질 차이: 각 팀의 데이터 관리 수준 천차만별

**심화된 문제**:
- 팀 간 신뢰 부족
- 데이터 품질 표준 부재
- 거버넌스 없이는 협업 불가능

---

## 🎯 전략 수립

### 핵심 목표

1. **Data Ownership 명확화**
   - 모든 데이터셋에 Business Owner (책임 팀) 지정
   - Technical Owner (ML Platform) 명시
   - Lineage를 통한 의존성 추적

2. **팀별 데이터 격리**
   - 도메인 기반 분리 (Index, Futures, Portfolio, Vendor 등)
   - 접근 제어: Owner만 수정, 비-Owner는 읽기
   - Keycloak SSO 통합

3. **메타데이터 자동 수집**
   - Airflow DAG → 자동 오너/태그 추출
   - DBT 모델 → _models.yml 메타데이터 수집
   - Snowflake → 테이블/뷰 구조 수집

4. **데이터 카탈로그 구축**
   - 검색 가능한 통합 카탈로그
   - Lineage 시각화
   - 비용 추적 (벤더별, 팀별)

### 기술 스택 선정

| 도구 | 역할 | 선정 이유 |
|------|------|-----------|
| **DataHub** | 메타데이터 플랫폼 | LinkedIn 오픈소스, 강력한 Lineage, GraphQL API |
| **Keycloak** | 인증/권한 관리 | OIDC 표준, Group 기반 권한, JIT Provisioning |
| **Airflow 3.0** | 파이프라인 오케스트레이션 | Asset 기반 Lineage, Custom Auth Manager API |
| **DBT** | 데이터 변환 | 4-layer 아키텍처, Tag/Owner metadata 지원 |
| **Snowflake** | 데이터 웨어하우스 | 이미 사용중, Tag 지원 |

**통합 전략**:
```
Keycloak (SSO)
    ↓ OIDC
┌───────────────┬─────────────┬──────────────┐
│   Airflow     │   DataHub   │  Snowflake   │
│  (Owner 태그) │ (메타데이터) │   (테이블)    │
└───────┬───────┴──────┬──────┴──────┬───────┘
        │              │             │
        └──────────────┴─────────────┘
              DataHub Ingestion
              - Airflow Custom Source
              - DBT S3 Manifest
              - Snowflake Connector
```

### 아키텍처 설계

**도메인 구조** (10개 도메인):
1. **Core**: 공통 차원 테이블 (dim_ticker, dim_holiday)
2. **Index**: 지수 구성 데이터 (QQQ, SPY, S&P 500)
3. **Futures**: 선물 데이터
4. **Employee**: 직원 데이터
5. **FRED**: 연준 경제 데이터
6. **USSimulation**: US 시뮬레이션 데이터
7. **Portfolio**: 포트폴리오 데이터
8. **Marketplace**: Snowflake Marketplace 데이터
9. **External**: 외부 API 데이터
10. **Vendor**: 벤더별 원천 데이터 (LSEG, FactSet, DataScope 등)

**팀별 소유권**:
- Strategy (T) → USSimulation, Portfolio
- HFT (T) → Futures, External (PCAP)
- MFT (T) → Index, Marketplace
- ML Platform (T) → Core (기술 관리), Employee
- 공통 → FRED, Vendor (Technical Owner만)

**URN 통일** (핵심 결정):
- Keycloak: `urn:li:corpGroup:ML+Platform+%28T%29` (quote_plus)
- Airflow: `urn:li:corpGroup:ML+Platform+%28T%29` (quote_plus)
- DBT: `urn:li:corpGroup:ML+Platform+%28T%29` (quote_plus)
→ 모든 시스템에서 동일한 URN 인코딩 사용 ([[URN-Encoding-통일|상세]])

---

## 📅 추진 과정

### 1단계: 현황 파악 (2025년 8월)

**목표**: 데이터 사용 현황 전수 조사

**활동**:
- [[팀별-원천-데이터-계약현황-파악]]: 벤더별 계약 비용 정리
- [[팀별-원천-데이터-사용현황-파악]]: 팀별 실제 사용 데이터 파악
- [[팀별-원천-데이터-적재현황-파악]]: Snowflake 적재 현황 분석

**결과**:
- 벤더 20개 이상 식별
- 팀별 데이터 의존성 맵핑
- 중복/미사용 데이터 발견 → 비용 절감 기회

### 2단계: 도구 선정 (2025년 9월)

**DataHub 선정**:
- 대안 검토: Amundsen, Atlas, OpenMetadata
- 선정 이유:
  1. Lineage 품질 (Asset-based)
  2. GraphQL API (자동화 용이)
  3. Keycloak OIDC 지원
  4. 활발한 커뮤니티

**Keycloak 선정**:
- 대안: Auth0 (유료), AWS Cognito (lock-in)
- 선정 이유:
  1. 오픈소스 (비용 절감)
  2. OIDC 표준 (다중 시스템 통합)
  3. Group 관리 (팀별 권한)
  4. JIT Provisioning (자동 계정 생성)

### 3단계: 구현 (2025년 10월 ~ 11월)

**Week 1-2 (10월 1주-2주)**: Keycloak SSO 구현
- Keycloak 서버 설정
- Airflow Custom Auth Manager 개발
- DataHub OIDC 연동
- [[Keycloak-SSO-도입-배경|상세 문서]]

**Week 3-4 (10월 3주-4주)**: Airflow 3.0 업그레이드
- Airflow 2.9 → 3.0 마이그레이션
- Custom Airflow Source 개발 (DataHub)
- Task Lineage 추출 로직 구현
- [[Airflow-3.0-업그레이드-배경|상세 문서]]

**Week 5-6 (11월 1주-2주)**: DBT 통합
- DBT 4-layer 아키텍처 설계
- _models.yml 메타데이터 정의
- URN Encoding 통일 (Patch)
- [[DBT-구현|상세 문서]]

**Week 7-8 (11월 3주-4주)**: DataHub 구축
- Domain Bootstrap (10개 도메인)
- Custom Sources 개발
- Access Policy 설정
- Ingestion 자동화

### 4단계: 롤아웃 (2025년 11월 말)

**Training**:
- 팀별 DataHub 사용법 교육
- Owner 지정 가이드 제공
- Troubleshooting 문서 배포

**Monitoring**:
- Ingestion 성공률 추적
- Lineage 커버리지 측정
- 팀별 피드백 수집

---

## 📊 성과

### 정량적 성과

| 지표 | Before | After | 개선율 |
|------|--------|-------|--------|
| **Data Owner Lookup** | 1시간+ | 5초 | **-99.8%** |
| **팀별 권한 충돌** | 월 1회 | 0회 | **-100%** |
| **Lineage 커버리지** | 0% | 85% | **+85%p** |
| **Onboarding 시간** | 1시간 | 5분 | **-92%** |
| **계정 수 (per user)** | 5개 | 1개 | **-80%** |
| **비밀번호 리셋 요청** | 월 15건 | 0건 | **-100%** |

### 정성적 성과

**CFO 만족**:
- "이제 누가 어떤 데이터 쓰는지 한눈에 보인다"
- 벤더 비용 검토 시간 단축 → 데이터 기반 협상

**팀별 피드백**:
- Strategy (T): "다른 팀 DAG 건드릴 일 없어서 안심"
- HFT (T): "실수로 우리 파이프라인 중단될 위험 제거"
- ML Platform (T): "권한 관리 자동화로 운영 부담 감소"

**데이터 품질 향상**:
- Owner가 명확하니 책임감 증가
- 메타데이터 문서화 → 데이터 이해도 증가
- Lineage → 영향도 분석 가능

---

## 🔗 관련 프로젝트

### 거버넌스 세부 프로젝트
- [[DataHub-도입]]: 메타데이터 플랫폼 선정 및 구축
- [[팀별-데이터-격리-체계]]: Domain/Ownership/Access Control 구현
- [[데이터-카탈로그-구축]]: 검색 및 Discovery 기능
- [[메타데이터-자동-수집-체계]]: Airflow/DBT/Snowflake 통합

### 인프라 프로젝트
- [[Keycloak-SSO-도입-배경]]: 통합 인증 체계
- [[Airflow-3.0-업그레이드-배경]]: 파이프라인 오케스트레이션
- [[TransferPipeline-도입-배경]]: 데이터 적재 표준화

### 주간 회고 (실제 경험)
- [[2025년 8월 11일]]: 문제 인식 ("데이터 관리가 개판임" - CFO 비용 의구심)
- [[2025년 10월 27일]]: 거버넌스 중요성 재확인 (팀 간 데이터 공유 저항)
- [[2025년 11월 24일]]: DataHub 론칭 완료, Airflow-DBT-Snowflake 연결

---

## 🛠️ 관련 기술

### 메타데이터 관리
- [[03-Resources/Technology/DataHub/DataHub-개념]]: DataHub 기본 개념
- [[03-Resources/Technology/DataHub/Custom-Sources]]: Airflow 3.x Connector

### 인증/권한
- [[03-Resources/Technology/Keycloak/Keycloak-OIDC-인증]]: OIDC 인증 흐름
- [[03-Resources/Technology/Keycloak/JIT-Provisioning]]: 자동 계정 생성

### 데이터 파이프라인
- [[03-Resources/Technology/Airflow/Airflow-3.0-구현]]: Custom Auth Manager
- [[03-Resources/Technology/DBT/DBT-구현]]: 4-layer 아키텍처

---

## 📝 교훈

### ✅ 잘한 점

1. **문제 조기 인식**: 8월에 CFO 우려 포착 → 9월 사고 전 조사 시작
2. **트리거 활용**: 사고 발생 → CFO 지원 확보 → 예산/인력 투입
3. **표준 준수**: OIDC, GraphQL 등 표준 프로토콜 → 확장 용이
4. **오픈소스 선택**: DataHub, Keycloak → 비용 절감, 커스터마이징 자유

### ⚠️ 개선 필요

1. **초기 저항 관리**: 팀별 데이터 공유 거부 → 점진적 설득 필요
2. **문서화 부족**: 기술 구현은 빨랐으나 사용자 가이드 늦음
3. **성능 테스트**: 대규모 Lineage 조회 시 느림 → 인덱싱 필요

### 🔮 향후 계획

1. **데이터 품질 측정**: Great Expectations 통합
2. **비용 최적화**: 벤더별 사용량 모니터링 대시보드
3. **자동 태깅**: ML 기반 데이터 분류 자동화
4. **Snowflake 격리**: Database-level 권한 관리

---

**작성일**: 2025-11-30  
**작성자**: ML Platform (T)  
**상태**: ✅ 구현 완료, 운영 중
